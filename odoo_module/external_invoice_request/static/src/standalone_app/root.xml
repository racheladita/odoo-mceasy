<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="external_invoice_request.ExternalSaleInvoiceForm">
        <div t-if="state.loading">Loading...</div>
        <div t-else="">
            <div class="card p-4 shadow-sm">
                <h4>Partner: <t t-esc="state.partner"/></h4>

                <div class="mt-3">
                    <label>Sale Orders:</label>
                    <select t-model="state.selectedSale" class="form-select">
                        <option value="">-- Select Sale Order --</option>
                        <t t-foreach="state.sale_orders" t-as="so" t-key="so.id">
                            <option t-att-value="so.id">
                                <t t-esc="so.name"/> — $<t t-esc="so.amount_total"/>
                            </option>
                        </t>
                    </select>
                </div>

                <button t-on-click="requestInvoice" class="btn btn-primary mt-3">
                    Request Invoice
                </button>
                <p class="mt-3 text-info"><t t-esc="state.message"/></p>
            </div>

            <div class="mt-5">
                <h5>Invoice Requests</h5>
                <table class="table table-striped mt-2">
                    <thead>
                        <tr>
                            <th>Sale Order</th>
                            <th>Status</th>
                            <th>Invoice</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="state.invoices" t-as="inv" t-key="inv.sale_order">
                            <tr>
                                <td><t t-esc="inv.sale_order"/></td>
                                <td><t t-esc="inv.status"/></td>
                                <td>
                                    <t t-if="inv.invoice_id">
                                        <button t-on-click="() => downloadInvoice(inv)" class="btn btn-success btn-sm">
                                            Download PDF
                                        </button>
                                    </t>
                                    <t t-else="">—</t>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
        </div>
    </t>
</templates>
